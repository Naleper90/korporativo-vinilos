<form [formGroup]="form" class="register-form">
  <fieldset class="register-form__fieldset">
    <legend class="register-form__legend">Crear cuenta</legend>

    <section class="form-input">
      <label for="reg-email">Email *</label>
      <input id="reg-email" type="email" formControlName="email" class="form-input__field" />
      <p *ngIf="form.get('email')?.touched && form.get('email')?.hasError('required')" class="form-input__error">
        El email es obligatorio.
      </p>
      <p *ngIf="form.get('email')?.touched && form.get('email')?.hasError('email')" class="form-input__error">
        Formato de email inválido.
      </p>
      <p *ngIf="form.get('email')?.touched && form.get('email')?.hasError('emailOcupado')" class="form-input__error">
        Este email ya está registrado.
      </p>
      <p *ngIf="form.get('email')?.pending" class="form-input__helper">Comprobando disponibilidad...</p>
    </section>

    <section class="form-input">
      <label for="reg-username">Usuario *</label>
      <input id="reg-username" type="text" formControlName="username" class="form-input__field" />
      <p *ngIf="form.get('username')?.touched && form.get('username')?.hasError('required')" class="form-input__error">
        El usuario es obligatorio.
      </p>
      <p *ngIf="form.get('username')?.touched && form.get('username')?.hasError('minlength')" class="form-input__error">
        Mínimo 4 caracteres.
      </p>
      <p *ngIf="form.get('username')?.touched && form.get('username')?.hasError('usernameOcupado')" class="form-input__error">
        Este nombre de usuario no está disponible.
      </p>
      <p *ngIf="form.get('username')?.pending" class="form-input__helper">Comprobando disponibilidad de usuario...</p>
    </section>

    <section class="form-input">
      <label for="reg-phone">Teléfono *</label>
      <input id="reg-phone" type="tel" formControlName="phone" class="form-input__field" />
      <p *ngIf="form.get('phone')?.touched && form.get('phone')?.hasError('required')" class="form-input__error">
        El teléfono es obligatorio.
      </p>
      <p *ngIf="form.get('phone')?.touched && form.get('phone')?.hasError('telefonoInvalido')" class="form-input__error">
        El teléfono debe tener 9 dígitos numéricos.
      </p>
    </section>

    <section class="form-input">
      <label for="reg-password">Contraseña *</label>
      <input id="reg-password" type="password" formControlName="password" class="form-input__field" />
      <p *ngIf="form.get('password')?.touched && form.get('password')?.hasError('required')" class="form-input__error">
        La contraseña es obligatoria.
      </p>
      <p *ngIf="form.get('password')?.touched && form.get('password')?.hasError('minlength')" class="form-input__error">
        Mínimo 8 caracteres.
      </p>
      <p *ngIf="form.get('password')?.touched && form.get('password')?.hasError('passwordFuerte')" class="form-input__error">
        Debe tener mayúsculas, minúsculas y números.
      </p>
    </section>

    <section class="form-input">
      <label for="reg-confirm">Confirmar contraseña *</label>
      <input id="reg-confirm" type="password" formControlName="confirmPassword" class="form-input__field" />
      <p *ngIf="form.get('confirmPassword')?.touched && form.get('confirmPassword')?.hasError('required')" class="form-input__error">
        La confirmación es obligatoria.
      </p>
      <p *ngIf="form.touched && form.hasError('passwordsNoCoinciden')" class="form-input__error">
        Las contraseñas no coinciden.
      </p>
    </section>

    <section formArrayName="telefonos" class="form-input">
      <label class="form-input__label">Teléfonos adicionales</label>
      <ng-container *ngFor="let tel of telefonosArray.controls; let i=index" [formGroupName]="i">
        <section class="form-input">
          <label>Teléfono {{i+1}}</label>
          <input [id]="'reg-tel-'+i" type="tel" formControlName="numero" class="form-input__field" />
          <p *ngIf="telefonosArray.at(i).get('numero')?.touched && telefonosArray.at(i).get('numero')?.hasError('required')" class="form-input__error">
            Teléfono obligatorio.
          </p>
          <p *ngIf="telefonosArray.at(i).get('numero')?.touched && telefonosArray.at(i).get('numero')?.hasError('telefonoInvalido')" class="form-input__error">
            9 dígitos numéricos.
          </p>
          <button type="button" (click)="removeTelefono(i)" class="btn btn--small">Eliminar</button>
        </section>
      </ng-container>
      <button type="button" class="btn btn--secondary" (click)="addTelefono()">+ Añadir teléfono</button>
    </section>

    <button type="button" class="btn btn--primary" [disabled]="form.invalid" (click)="onSubmit()">
      Registrarse
    </button>

    <section class="form-success">
      <span *ngIf="submitted">¡Cuenta creada!</span>
    </section>
  </fieldset>
</form>
